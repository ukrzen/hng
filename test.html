<!DOCTYPE html>
<html>
<head>
    <title>Force Touch Test</title>
    <style>
        .pointer
        {
            transform-origin:50% 50% 0;
            width:64px;
            height:64px;

            position:absolute;
            border-radius:100%;
            background-color:green;
            transition:transform 0.5s ease, opacity 1s ease;
            transform:scale(0.1,0.1);
            /*opacity:0;*/
        }
        .pointer.visible
        {
            /*transform:scale(1,1);*/
            /*opacity:1;*/
        }
    </style>

    <meta name="apple-mobile-web-app-title" content="Ханѓ">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
    <script src="assets/howler.js"></script>
    <script>
        $(function(){
            $(document).on("touchstart scroll touchmove",function(event){
//                $(".pointer").css({"left":(event.clientX -32) + "px","top":(event.clientY-32)+ "px"})

//                event.preventDefault();
            });
          ;
            letter = "C";
            var sounds=[];
            for(var i=1;i <= 15;i++)
            {
                layer = i;
                if(i < 10)
                {
                    layer = "0" +i;
                }
                sounds.push(new Howl({
                    urls: ["samples/" + letter  + layer + ".wav.mp3",
                        "samples/" + letter  + layer +  ".wav.ogg"],

                  }))
            }

            $(document).on(" touchend",function(event){
//                $(".pointer").removeClass("visible");

                $(".pointer").css("transform", "scale(" + realPressure + "," + realPressure + ")");

                $(document).attr("title", realPressure);
                if(realPressure > 2)
                    realPressure=2;

                sounds[Math.floor(((realPressure- 0.3) /1.8) * 15)].play();

//                event.preventDefault();
            });
         var CPBPressureNone   =      0.0;
var CPBPressureLight =       0.1;
var  CPBPressureMedium =       0.3;
var  CPBPressureHard    =     0.8;
var CPBPressureInfinite =   2.0;
            var   pressureValues =[];
            for(var i=0;i<30;i++)
                pressureValues.push(0.0);

            var currentPressureValueIndex =0 ;
            var setNextPressureValue = 0;
            var KNumberOfPressureSamples=20;
            var  minimumPressureRequired =CPBPressureMedium;
            var realPressure=0;
            var maximumPressureRequired= CPBPressureInfinite;
            setInterval(function(){
                setNextPressureValue=KNumberOfPressureSamples;
            },500)
            window.ondevicemotion = function(event) {
                var sz=30;
                var a = event.acceleration.z;
                pressureValues[currentPressureValueIndex%sz] = a;

                if (setNextPressureValue > 0) {

                    // calculate average pressure
                    var total = 0.0;
                    for (var loop=0; loop<sz; loop++) total += pressureValues[loop];
                    var average = total / sz;

                    // start with most recent past pressure sample
                    if (setNextPressureValue == KNumberOfPressureSamples) {
                        var mostRecent = pressureValues[(currentPressureValueIndex-1)%sz];
                        pressure = Math.abs(average - mostRecent);
                    }

                    // caluculate pressure as difference between average and current acceleration
                    var diff = Math.abs(average - event.acceleration.z);
                    if (pressure < diff) pressure = diff;
                    setNextPressureValue--;

                    if (setNextPressureValue == 0) {
                        if (pressure >= minimumPressureRequired && pressure <= maximumPressureRequired) {

                            realPressure=pressure;


                        }
                        else
                          {

                          }
                    }
                }

                currentPressureValueIndex++;
            }
        })

    </script>


</head>
<body>
<div class="pointer"></div>

</body>

</html>

